<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Area Riservata</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="container">
    <h1>Benvenuto nell'Area Riservata</h1>
    <p id="userEmail"></p>
    <h2>Scarica i Materiali</h2>
    <ul id="pdfList"></ul>
    <button onclick="logout()" class="btn">Esci</button>
  </div>

  <script>
    // ==================== CONFIGURAZIONE SUPABASE ====================
    const supabaseUrl = 'https://norfhoxpzdnbainkbwlw.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vcmZob3hwemRuYmFpbmtid2x3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4MDY4MzUsImV4cCI6MjA3ODM4MjgzNX0.SPP1DnlpnRMPVtEDir1pb74tGfMqNzxeIqMGSKaVr7A';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    // ==================== CHECK AUTH ====================
    async function checkAuth() {
      const { data: { session } } = await supabase.auth.getSession();
      
      if (!session) {
        window.location.href = "index.html";
        return;
      }
      
      // Mostra email utente (senza dominio)
      const email = session.user.email;
      const displayEmail = email.replace("@fantavenezia.it", "").replace(/@.*$/, "");
      document.getElementById("userEmail").textContent = "Utente: " + displayEmail;
      
      // Mostra PDF
      showDownloads();
    }

    // ==================== LISTA PDF ====================
    const pdfs = [
      { name: "Regolamento - Fantacalcio Venezia.pdf", link: "https://drive.google.com/uc?export=download&id=1iZwtWh7W_U4YzYeAAucUB_5LBFcHJRj1" },
      { name: "Termini e Condizioni - Fantacalcio Venezia.pdf", link: "https://drive.google.com/uc?export=download&id=1EsEGBJQxrCTlEnABfcbv7SPaNnvlv7WH" }
    ];

    function showDownloads() {
      const list = document.getElementById("pdfList");
      pdfs.forEach(pdf => {
        const li = document.createElement("li");
        li.innerHTML = `<a href="${pdf.link}" target="_blank">${pdf.name}</a>`;
        list.appendChild(li);
      });
    }

    // ==================== LOGOUT ====================
    async function logout() {
      await supabase.auth.signOut();
      window.location.href = "index.html";
    }

    // ==================== INIZIALIZZAZIONE ====================
    document.addEventListener('DOMContentLoaded', function() {
      checkAuth();
    });

    // Ascolta cambiamenti di autenticazione
    supabase.auth.onAuthStateChange((event, session) => {
      if (event === 'SIGNED_OUT') {
        window.location.href = "index.html";
      }
    });
  </script>
</body>
</html>
