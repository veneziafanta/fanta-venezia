<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fantacalcio Venezia</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial; background: #f0f2f5; margin: 0; padding: 20px; }
    .container { max-width: 500px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
    button { padding: 12px 20px; background: #1a5fb4; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 10px; font-size: 16px; }
    button:hover { background: #0d47a1; }
    input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Fantacalcio Venezia</h1>
   
    <div id="authButtons">
      <button onclick="showLogin()">ACCEDI</button>
      <button onclick="showRegister()">REGISTRATI</button>
    </div>

    <div id="loginSection" class="hidden">
      <h2>Accedi</h2>
      <input type="email" id="loginEmail" placeholder="Email" />
      <input type="password" id="loginPassword" placeholder="Password" />
      <button onclick="login()">Entra</button>
      <p><a href="#" onclick="showReset()">Password dimenticata?</a></p>
      <p id="loginStatus"></p>
    </div>

    <div id="registerSection" class="hidden">
      <h2>Registrati</h2>
      <input type="email" id="regEmail" placeholder="Email" />
      <input type="password" id="regPassword" placeholder="Password (min. 6 caratteri)" />
      <button onclick="register()">Crea Account</button>
      <p id="registerStatus"></p>
    </div>

    <div id="resetSection" class="hidden">
      <h2>Reset Password</h2>
      <input type="email" id="resetEmail" placeholder="Email" />
      <button onclick="resetPassword()">Invia Link Reset</button>
      <p id="resetStatus"></p>
    </div>

    <div id="userSection" class="hidden">
      <h2>Benvenuto!</h2>
      <p id="userEmail"></p>
      <button onclick="logout()">Esci</button>
    </div>
  </div>

  <script>
    // SUPABASE CONFIG
    const supabase = window.supabase.createClient(
      'https://norfhoxpzdnbainkbwlw.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vcmZob3hwemRuYmFpbmtid2x3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4MDY4MzUsImV4cCI6MjA3ODM4MjgzNX0.SPP1DnlpnRMPVtEDir1pb74tGfMqNzxeIqMGSKaVr7A'
    );

    // CONTROLLA SE L'UTENTE È LOGGATO
    supabase.auth.getSession().then(({ data: { session } }) => {
      if (session) {
        showUserSection(session.user.email);
      }
    });

    function showLogin() {
      hideAll();
      document.getElementById('loginSection').classList.remove('hidden');
    }

    function showRegister() {
      hideAll();
      document.getElementById('registerSection').classList.remove('hidden');
    }

    function showReset() {
      hideAll();
      document.getElementById('resetSection').classList.remove('hidden');
    }

    function showUserSection(email) {
      hideAll();
      document.getElementById('userEmail').textContent = email;
      document.getElementById('userSection').classList.remove('hidden');
    }

    function hideAll() {
      document.getElementById('authButtons').classList.add('hidden');
      document.getElementById('loginSection').classList.add('hidden');
      document.getElementById('registerSection').classList.add('hidden');
      document.getElementById('resetSection').classList.add('hidden');
      document.getElementById('userSection').classList.add('hidden');
    }

    // LOGIN
    async function login() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      const { data, error } = await supabase.auth.signInWithPassword({
        email: email,
        password: password
      });

      if (error) {
        document.getElementById('loginStatus').textContent = 'Errore: ' + error.message;
      } else {
        showUserSection(data.user.email);
      }
    }

    // REGISTRAZIONE
    async function register() {
      const email = document.getElementById('regEmail').value;
      const password = document.getElementById('regPassword').value;
      
      const { data, error } = await supabase.auth.signUp({
        email: email,
        password: password,
        options: {
          emailRedirectTo: 'https://veneziafanta.github.io'
        }
      });

      if (error) {
        document.getElementById('registerStatus').textContent = 'Errore: ' + error.message;
      } else {
        document.getElementById('registerStatus').textContent = '✅ Controlla la tua email per verificare l\'account!';
      }
    }

    // RESET PASSWORD - VERSIONE CORRETTA
    async function resetPassword() {
      const email = document.getElementById('resetEmail').value;
      
      const { data, error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: 'https://veneziafanta.github.io'
      });

      if (error) {
        document.getElementById('resetStatus').textContent = 'Errore: ' + error.message;
      } else {
        document.getElementById('resetStatus').textContent = '✅ Link di reset inviato! Controlla la tua email.';
      }
    }

    // LOGOUT
    async function logout() {
      await supabase.auth.signOut();
      location.reload();
    }
  </script>
</body>
</html>
